<Project Sdk="Vezel.Zig.Sdk">

    <PropertyGroup>
        <OutputType>Library</OutputType>
        <AssemblyName>AngelScript.Native</AssemblyName>
        <PublicHeadersPath>../AngelScript.Native/sdk/angelscript/include/</PublicHeadersPath>
        <RuntimeIdentifiers>linux-x64</RuntimeIdentifiers>
        <DefineConstants>ANGELSCRIPT_DLL_LIBRARY_IMPORT</DefineConstants>
        <RootNamespace>AngelScript.Zig</RootNamespace>
    </PropertyGroup>
    
    <ItemGroup>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_atomic.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_builder.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_bytecode.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_mips.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_ppc.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_ppc_64.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_sh4.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_x86.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_x64_gcc.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_x64_mingw.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_compiler.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_context.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_configgroup.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_datatype.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_generic.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_gc.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_globalproperty.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_memory.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_module.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_objecttype.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_outputbuffer.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_parser.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_restore.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_scriptcode.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_scriptengine.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_scriptfunction.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_scriptnode.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_scriptobject.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_string.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_string_util.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_thread.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_tokenizer.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_typeinfo.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_variablescope.cpp"/>
        <Compile Include="angelscript_capi.cpp"/>
        
        <!--<LinkerReference Include="threads"/>-->
    </ItemGroup>
    
    <ItemGroup Condition="$(RuntimeIdentifier.EndsWith('-arm'))">
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_arm.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_arm_gcc.S"/>
    </ItemGroup>

    <ItemGroup Condition="$(RuntimeIdentifier.EndsWith('-arm64'))">
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_arm64.cpp"/>
        <Compile Include="../AngelScript.Native/sdk/angelscript/source/as_callfunc_arm64_gcc.S"/>
    </ItemGroup>

    <ItemGroup>
      <ClInclude Include="angelscript_capi.h" />
    </ItemGroup>

    <ItemGroup>
      <ClCompile Include="angelscript_capi.cpp" />
    </ItemGroup>

    <Target Name="_GetNativeLibrary"
            Returns="@(_NativeLibrary)">
        <ItemGroup>
            <_NativeLibrary Include="$(TargetPath)"
                            Symbols="@(_DebugSymbolsOutputPath)"
                            RuntimeIdentifier="$(RuntimeIdentifier)" />
        </ItemGroup>
    </Target>

    <Target Name="_GetNativeLibraries"
            Returns="@(_NativeLibrary)">
        <ItemGroup>
            <_RuntimeIdentifiers Include="$(RuntimeIdentifiers)" />
            <_Projects Include="$(MSBuildProjectFullPath)"
                       Properties="RuntimeIdentifier=%(_RuntimeIdentifiers.Identity)" />
        </ItemGroup>

        <MSBuild Projects="@(_Projects)"
                 Targets="_GetNativeLibrary"
                 BuildInParallel="$(BuildInParallel)">
            <Output TaskParameter="TargetOutputs"
                    ItemName="_NativeLibrary" />
        </MSBuild>
    </Target>

</Project>
